# RAG 프로세스 구축기

> 목표는 일반적으로 쓸 수 있는 RAG를 구축하는 것.

- 일반적으로 쓸 수 있다의 기준은 모호하지만, 그게 명확하다.
- 최대한 정확도가 높은 도구들을 사용할테지만, 시간이 지나면 역시나 성능은 하락할 예정.
- 도커로 구축해서, 어느 환경이든 쉽게 접근 할 수 있도록 한다.
- 현재 24.12.11 이고, 목표는 24.12.20이다.

# 전체 프로세스

## 데이터 처리 (문서 기준 설명)

> 아마도 가장 중요한 부분이지 않을까 싶다.

- 문서를 읽어온다.
- 청킹을 한다. (Splitter 이용)
- Embedding을 이용해서 벡터로 변환한다.
- 전환된 벡터를 DB에 저장한다.

## 질의 처리

- 데이터를 Retriver로 읽어온다.
- 가져온 데이터 중에 유사도를 확인해서 답변을 선택한다.
- 참고해서 답변을 구성한다.

# 현재 상황

- 전체적인 프로세스는 구축이 되었다.
- 사용할 정도의 완성도가 아니다. (검색을 하면, 정확한 답변이 나오지 않는다.)
- 고로 Loader - Splitter를 먼저 확인하고 (Embedding은 OpenAI를 믿지만 차후에 수정할수도있다.)
- Retriever까지 개선해서 다시 결과물을 확인해본다.
- 현재의 결과물은 지금 구성하는 커밋에서 (마지막으로) 사용할 수 있을 예정이다.

# 해야할 일

- [x] 문서를 OCR 처리할 때의 전반적인 로직을 수정하고, 일반적인 로더를 처리하는 것처럼 meta_data를 생성한다.
- [x] 전처리 과정을 확인하고 문제를 파악한다.
- [x] 메타 데이터 값을 다시 확인 중이다.
  - 처음의 메타데이터는 각 페이지의 메타데이터라면,
  - 지금의 값은 청크로 나눠진 다음의 메타데이터다.
  - 청크의 단위를 현재는 더 줄여야하는지 이렇게 늘여도 되는지도 잘 모른다.
  - 그래서 처리 완료 후에 해당 값을 조정해야하는지 확인하는 작업도 추가될지 모른다.
- [x] LLM을 이용해서 청킹하는 부분을 구성한다.
- [x] 새롭게 구성된 문서 데이터를 vector에 저장하도록 한다.
- [x] 해당 vector를 기반으로 retriever을 구성 및 수정한다.
- [x] query처리로 RAG의 정상작동을 확인한다.
- [ ] 기존 로직과의 비교로 성능을 확인한다.

# 추가적인 사용성 고민

- 문서 폴더를 watcher로 감시하는게 아니라, 그냥 파일을 올리는 형식으로 진행하는게 어떨까?
- 전처리된 문서를 따로 저장하지않는게 어떨까? (bm25)
